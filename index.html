<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Laporan Jawatankuasa</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f2f2f2; }
    select, input { padding: 6px; margin: 5px 0; }
  </style>
</head>
<body>
  <h2>Laporan Jawatankuasa</h2>

  <!-- Dropdown kategori -->
  <label for="kategori">Pilih Kategori:</label>
  <select id="kategori">
    <option value="">-- Semua --</option>
    <option value="PT">Pentadbiran (PT)</option>
    <option value="PAM">Pengajian Am (PAM)</option>
    <option value="QA">Sains Kuantitatif (QA)</option>
    <option value="ACC">Perakaunan (ACC)</option>
  </select>

  <!-- Combobox staf -->
  <label for="staf">Cari Nama Staf:</label>
  <select id="staf">
    <option value="">-- Pilih Staf --</option>
  </select>

  <table id="data-table">
    <thead>
      <tr>
        <th>Kod Portfolio</th>
        <th>Nama Portfolio</th>
        <th>Jawatan</th>
        <th>Pemberat</th>
        <th>Kategori (E)</th>
        <th>Nama Staf</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr>
        <td colspan="3"><strong>Jumlah Pemberat</strong></td>
        <td id="total-pemberat"></td>
        <td colspan="2"><strong>Bil Kod Portfolio:</strong> <span id="bil-portfolio"></span></td>
      </tr>
    </tfoot>
  </table>

  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbyERtoUECTrD-fyBXTUfbKc1PFHpcVuIFGAoVbaYymkQ5UVtsDmPSq_QRc4qeet_hp1kw/exec";

    let allData = [];

    async function fetchData() {
      const res = await fetch(apiUrl);
      allData = await res.json();
      populateStafCombo();
      renderTable();
    }

    function populateStafCombo() {
      const stafSelect = document.getElementById("staf");
      const uniqueStaf = [...new Set(allData.map(r => r[5]))]; // Column F = Nama Staf
      uniqueStaf.forEach(staf => {
        if (staf) {
          let opt = document.createElement("option");
          opt.value = staf;
          opt.textContent = staf;
          stafSelect.appendChild(opt);
        }
      });
    }

    function renderTable() {
      const kategori = document.getElementById("kategori").value;
      const staf = document.getElementById("staf").value;
      const tbody = document.querySelector("#data-table tbody");
      tbody.innerHTML = "";

      let filtered = allData;

      // filter ikut kategori (Column E = index 4)
      if (kategori) {
        filtered = filtered.filter(r => r[4] && r[4].endsWith(kategori));
      }

      // filter ikut staf
      if (staf) {
        filtered = filtered.filter(r => r[5] === staf);
      }

      let total = 0;
      filtered.forEach(r => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${r[0]}</td>
          <td>${r[1]}</td>
          <td>${r[2]}</td>
          <td>${r[3]}</td>
          <td>${r[4]}</td>
          <td>${r[5]}</td>
        `;
        tbody.appendChild(row);
        total += Number(r[3]) || 0;
      });

      document.getElementById("total-pemberat").textContent = total;
      document.getElementById("bil-portfolio").textContent = filtered.length;
    }

    document.getElementById("kategori").addEventListener("change", renderTable);
    document.getElementById("staf").addEventListener("change", renderTable);

    fetchData();
  </script>
</body>
</html>
