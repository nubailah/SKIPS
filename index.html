<!DOCTYPE html>
<html>
<head>
  <title>Carian Jawatankuasa</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    select, table { margin-top: 10px; }
    table { border-collapse: collapse; width: 60%; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    .summary { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Carian Jawatankuasa Staf</h2>
  
  <label>Pilih Nama Staf:</label>
  <select id="staffSelect"></select>

  <table id="resultTable">
    <thead>
      <tr>
        <th>Nama Unit</th>
        <th>Jawatan</th>
        <th>P'berat</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="summary">
    Jumlah P’berat: <span id="totalWeight">0</span><br>
    Jumlah Unit: <span id="totalUnit">0</span>
  </div>

  <script>
    const API_KEY = "AIzaSyDZ_H2MYtZHrAdxLGxYNUwrUcXUJRrrS34";
    const SPREADSHEET_ID = "1uFVEYip6WQEOUugGXA48QkqqweU2dnFj7cFZaSqwvBM";
    const RANGE = "ALL!A:D";  // A = Nama Staf, B = Nama Unit, C = Jawatan, D = P’berat

    async function loadData() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      const res = await fetch(url);
      const data = await res.json();
      const values = data.values.slice(1); // buang header row

      const staffSelect = document.getElementById("staffSelect");
      const uniqueStaff = [...new Set(values.map(row => row[0]))];

      // isi dropdown
      uniqueStaff.forEach(staff => {
        const option = document.createElement("option");
        option.value = staff;
        option.textContent = staff;
        staffSelect.appendChild(option);
      });

      staffSelect.addEventListener("change", () => displayStaff(values, staffSelect.value));
    }

    function displayStaff(values, selectedStaff) {
      const tbody = document.querySelector("#resultTable tbody");
      tbody.innerHTML = "";

      let totalWeight = 0;
      let units = new Set();

      values.forEach(row => {
        const [nama, unit, jawatan, berat] = row;
        if (nama === selectedStaff) {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${unit}</td><td>${jawatan}</td><td>${berat}</td>`;
          tbody.appendChild(tr);

          totalWeight += Number(berat);
          units.add(unit);
        }
      });

      document.getElementById("totalWeight").textContent = totalWeight;
      document.getElementById("totalUnit").textContent = units.size;
    }

    loadData();
  </script>
</body>
</html>
