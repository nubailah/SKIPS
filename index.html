<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Display Google Sheet Data</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
  table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
  th, td { border: 1px solid #000; padding: 5px; text-align: left; }
  th { background-color: #f2f2f2; }
</style>
</head>
<body>
<h2>Carian Staf (Column F)</h2>
<select id="stafDropdown">
  <option value="">-- Pilih Staf --</option>
</select>

<table id="stafTable">
  <thead>
    <tr>
      <th>Column A</th>
      <th>Column B</th>
      <th>Column C</th>
      <th>Column D</th>
    </tr>
  </thead>
  <tbody id="stafTableBody"></tbody>
</table>
<p><strong>Jumlah Column D:</strong> <span id="stafSumD">0</span></p>

<script>
const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTKxmTXERKgk9gTUlqlyeRrmdfJU21FMdj1mDpf5azCa_hW4Gfg5TgpQcHvb-ujRo72cLIN2p0Lkgcj/pub?output=csv&gid=975658514';
let sheetData = [];

// Fetch CSV & parse dengan PapaParse
Papa.parse(sheetURL, {
  download: true,
  header: false,
  skipEmptyLines: true,
  complete: function(results) {
    sheetData = results.data;

    // Populate staf dropdown (Column F, index 5)
    const stafDropdown = document.getElementById('stafDropdown');
    const uniqueStaf = [...new Set(sheetData.map(r => r[5].trim()))];
    uniqueStaf.forEach(staf => {
      const option = document.createElement('option');
      option.value = staf;
      option.textContent = staf;
      stafDropdown.appendChild(option);
    });
  }
});

// Event staf dropdown
document.getElementById('stafDropdown').addEventListener('change', function() {
  const selected = this.value;
  const filtered = sheetData.filter(r => r[5].trim() === selected);

  const tbody = document.getElementById('stafTableBody');
  tbody.innerHTML = '';

  filtered.forEach(r => {
    const tr = document.createElement('tr');
    [0,1,2,3].forEach(i => {
      const td = document.createElement('td');
      td.textContent = r[i];
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  const sumD = filtered.reduce((acc,r) => acc + parseFloat(r[3] || 0), 0);
  document.getElementById('stafSumD').textContent = sumD;
});
</script>
</body>
</html>
